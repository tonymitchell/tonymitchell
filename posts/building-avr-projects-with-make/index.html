<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Building AVR projects with make" /><meta property="og:locale" content="en" /><meta name="description" content="In this guide we’ll go through the process of setting up a Makefile to build a simple AVR project." /><meta property="og:description" content="In this guide we’ll go through the process of setting up a Makefile to build a simple AVR project." /><link rel="canonical" href="https://www.tonymitchell.ca/posts/building-avr-projects-with-make/" /><meta property="og:url" content="https://www.tonymitchell.ca/posts/building-avr-projects-with-make/" /><meta property="og:site_name" content="Tony Mitchell" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-21T11:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Building AVR projects with make" /><meta name="twitter:site" content="@tony_a_mitchell" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-06T18:55:33-07:00","datePublished":"2022-05-21T11:00:00-07:00","description":"In this guide we’ll go through the process of setting up a Makefile to build a simple AVR project.","headline":"Building AVR projects with make","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.tonymitchell.ca/posts/building-avr-projects-with-make/"},"url":"https://www.tonymitchell.ca/posts/building-avr-projects-with-make/"}</script><title>Building AVR projects with make | Tony Mitchell</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tony Mitchell"><meta name="application-name" content="Tony Mitchell"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/1694080?s=400&v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Tony Mitchell</a></div><div class="site-subtitle font-italic">My little piece of the net</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tonymitchell" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/tony_a_mitchell" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Building AVR projects with make</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Building AVR projects with make</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/tony_a_mitchell">Tony Mitchell</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1653156000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-21 </em> </span> <span> Updated <em class="timeago" data-ts="1654566933" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-06 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1088 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>In this guide we’ll go through the process of setting up a Makefile to build a simple AVR project.</p><p>This guide assumes you have already set up a working AVR toolchain. If not please follow one of these guides first:</p><ul><li><a href="/posts/setup-avr-toolchain-on-windows/">How to setup the AVR toolchain on Windows</a><li><a href="/posts/setup-avr-toolchain-on-wsl/">How to setup the AVR toolchain on WSL2 (Windows 10+)</a><li><a href="/posts/setup-avr-toolchain-on-linux/">How to setup the AVR toolchain on Linux</a></ul><h2 id="project-setup"><span class="mr-2">Project setup</span><a href="#project-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Before we get into the Makefile, let’s setup a basic project consisting of a sample AVR program, blink.c, in a new directory. This basic program will blink an LED on and off every 500ms.</p><ol><li>Create a new directory named <code class="language-plaintext highlighter-rouge">blinker</code> to hold your project. It doesn’t matter what it’s named, but name it <code class="language-plaintext highlighter-rouge">blinker</code> so your your output matches the tutorial.<li>Create a new file named <code class="language-plaintext highlighter-rouge">blink.c</code>, and with the following contents:<div file="blink.c" class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="blink.c"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre> <span class="cp">#include</span> <span class="cpf">&lt;avr/io.h&gt;</span><span class="cp">
</span> <span class="cp">#include</span> <span class="cpf">&lt;util/delay.h&gt;</span><span class="cp">
</span>
 <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
 <span class="p">{</span>
     <span class="c1">// Set built-in LED pin as output</span>
     <span class="n">DDRB</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">DDB5</span><span class="p">);</span>
     <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">PORTB</span> <span class="o">|=</span>  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">PB5</span><span class="p">);</span>   <span class="c1">// LED on</span>
         <span class="n">_delay_ms</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>         <span class="c1">// wait 500ms</span>
         <span class="n">PORTB</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">PB5</span><span class="p">);</span>   <span class="c1">// LED off</span>
         <span class="n">_delay_ms</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>         <span class="c1">// wait 500ms</span>
     <span class="p">}</span>
     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</pre></table></code></div></div></ol><h2 id="building-it-manually"><span class="mr-2">Building it manually</span><a href="#building-it-manually" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now that we have the project set up, let’s try building it manually first to see what’s involved.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>avr-gcc blink.c <span class="nt">-o</span> blinker.elf <span class="nt">-mmcu</span><span class="o">=</span>atmega328p <span class="nt">-DF_CPU</span><span class="o">=</span>16000000UL <span class="nt">-Os</span>
</pre></table></code></div></div><p>If it was successful, you’ll now have an compiled binary file along with your original .c file. You can remove that file before we continue:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">rm </span>blinker.elf
</pre></table></code></div></div><h2 id="setting-up-a-project-makefile"><span class="mr-2">Setting up a project Makefile</span><a href="#setting-up-a-project-makefile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>While you can certainly build the project like we did above, it error prone and more work especially when</p><p>Rather than starting from scratch, I recommend using this <a href="https://github.com/hexagon5un/AVR-Programming/blob/master/setupProject/Makefile">Makefile</a> as a starting point. It was written by the author of the <a href="https://www.oreilly.com/library/view/make-avr-programming/9781449356484/">Make: AVR Programming</a> book, and is a good place to get started. It only requires a few edits to adjust for your chip and programmer.</p><p>In your source folder, run the following commands to download the latest version of the Makefile, and make a few adjustments to it avoid errors since we’re not using his full project template.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># Download Makefile</span>
wget https://raw.githubusercontent.com/hexagon5un/AVR-Programming/master/setupProject/Makefile

<span class="c"># Remove LIBDIR that we're not using</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s1">'s/^\(LIBDIR =.\+\)/\#\1 \# Not used/'</span> <span class="nt">-e</span> <span class="s1">'s/ -I$(LIBDIR)//'</span> Makefile
</pre></table></code></div></div><h2 id="configuring-the-makefile-for-your-chip-and-programmer"><span class="mr-2">Configuring the Makefile for your chip and programmer</span><a href="#configuring-the-makefile-for-your-chip-and-programmer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The next commands will configure the Makefile for building and flashing programs for the Arduino dev board. If you’re using a different chip or programmer you’ll need to either adjust these commands or make the adjustments manually.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># SETUP FOR ARDUINO</span>
<span class="c"># Use ATmega328p and 16MHz with arduino programmer</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s1">'s/^MCU.*/MCU   = atmega328p/'</span> <span class="nt">-e</span> <span class="s1">'s/^F_CPU.*/F_CPU = 16000000UL/'</span> Makefile
<span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s1">'s/^PROGRAMMER_TYPE.*/PROGRAMMER_TYPE = arduino/'</span> <span class="nt">-e</span> <span class="s1">'s/^PROGRAMMER_ARGS.*/PROGRAMMER_ARGS = -P \/dev\/ttyACM0/'</span> Makefile
</pre></table></code></div></div><p>If you’re adjusting the Makefile manually, these lines at the top of the file are the ones you need to edit. I’ll explain them each briefly below:</p><div class="language-make highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="c">##########------------------------------------------------------##########
##########              Project-specific Details                ##########
##########    Check these every time you start a new project    ##########
##########------------------------------------------------------##########
</span>
<span class="nv">MCU</span>   <span class="o">=</span> atmega328p
<span class="nv">F_CPU</span> <span class="o">=</span> 16000000UL  
<span class="nv">BAUD</span>  <span class="o">=</span> 9600UL
<span class="c">## Also try BAUD = 19200 or 38400 if you're feeling lucky.
</span>
<span class="c">## A directory for common include files and the simple USART library.
## If you move either the current folder or the Library folder, you'll 
##  need to change this path to match.
#LIBDIR = ../../AVR-Programming-Library
</span>
<span class="c">##########------------------------------------------------------##########
##########                 Programmer Defaults                  ##########
##########          Set up once, then forget about it           ##########
##########        (Can override.  See bottom of file.)          ##########
##########------------------------------------------------------##########
</span>
<span class="nv">PROGRAMMER_TYPE</span> <span class="o">=</span> arduino
<span class="c"># extra arguments to avrdude: baud rate, chip type, -F flag, etc.
</span><span class="nv">PROGRAMMER_ARGS</span> <span class="o">=</span> <span class="nt">-P</span> /dev/ttyACM0
</pre></table></code></div></div><dl><dt>MCU<dd>Defines what MicroController Unit (MCU) you are using. This variable is passed to both GCC and avrdude. For example, atmega328p is the MCU on an Arduino board. The complete list of options can be found in the <a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Options.html#AVR-Options">GCC documentation</a>. In addition to providing the compiler with instruction set and hardware details, this also sets up the appropriate <code class="language-plaintext highlighter-rouge">#define</code> values that control the AVR libary’s header definitions for pins, ports, etc.<dt>F_CPU<dd>Define the clock frequency of the MCU in Hz. Used by GCC. This value needs to match the fuse settings on your AVR chip. If not your program’s timing will not be correct. We’re using 16 MHz (16,000,000 Hz) for the Arduino.<dt>BAUD<dd>The baud rate for serial operations both by GCC for your program and avrdude for communication via serial programmers (if used in the PROGRAMMER_ARGS).<dt>PROGRAMMER_TYPE<dd>Type of programmer you are using (e.g. arduino, usbasp, etc.). Used by avrdude to communicate with your chip. We are using arduino for the Arduino dev board.<dt>PROGRAMMER_ARGS<dd>Additional arguments for avrdude. Some programmers require additional arguments such as the serial port to use. For example, when using arduino as the PROGRAMMER_TYPE we need to specify the serial port here (e.g. <code class="language-plaintext highlighter-rouge">-P /dev/ttyACM0</code>).</dl><blockquote><p><strong>Configuration examples</strong></p><p>Example 1. Settings for building with the Arduino board:</p><div class="language-make highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">MCU</span>   <span class="o">=</span> atmega328p
<span class="nv">F_CPU</span> <span class="o">=</span> 16000000UL  
<span class="nv">PROGRAMMER_TYPE</span> <span class="o">=</span> arduino
<span class="nv">PROGRAMMER_ARGS</span> <span class="o">=</span> <span class="nt">-P</span> /dev/ttyACM0
</pre></table></code></div></div><p>Example 2. Settings for building with the ATtiny85 and USBasp programmer:</p><div class="language-make highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">MCU</span>   <span class="o">=</span> attiny85
<span class="nv">F_CPU</span> <span class="o">=</span> 8000000UL  
<span class="nv">PROGRAMMER_TYPE</span> <span class="o">=</span> usbasp
<span class="nv">PROGRAMMER_ARGS</span> <span class="o">=</span> 
</pre></table></code></div></div></blockquote><h2 id="executing-the-makefile"><span class="mr-2">Executing the Makefile</span><a href="#executing-the-makefile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Once we have the Makefile configured appropriately, we can run it using the <code class="language-plaintext highlighter-rouge">make</code> or <code class="language-plaintext highlighter-rouge">make all</code> command. Both commands are equivalent for this Makefile as <code class="language-plaintext highlighter-rouge">all</code> is the first/default target defined in the Makefile. Running either of these commands will build your project and produce an Intel hex (.hex) file that ready to be flashed to your chip.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>make all
</pre></table></code></div></div><p>The next step is to flash the chip using <code class="language-plaintext highlighter-rouge">make flash</code>. When using <code class="language-plaintext highlighter-rouge">make flash</code> it isn’t necessary to run <code class="language-plaintext highlighter-rouge">make all</code> first since it will automatically execute the build step if anything has changed.</p><p>You will need to make sure that your Arduino (or other programmer) is connected to the computer. You may need to run this command with sudo if your user doesn’t have the appropriate privileges to access the device. See <a href="/posts/programming-avr-in-wsl-tips-and-tricks/">Programming AVR in WSL Tips and Tricks</a> to learn how to fix this.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>make flash
</pre></table></code></div></div><p>Another handy make target you can use is <code class="language-plaintext highlighter-rouge">make clean</code> or <code class="language-plaintext highlighter-rouge">make squeaky_clean</code> remove all the intermediate and final build output files.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>make squeaky_clean
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorial/'>Tutorial</a>, <a href='/categories/avr/'>AVR</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a> <a href="/tags/avr/" class="post-tag no-text-decoration" >avr</a> <a href="/tags/make/" class="post-tag no-text-decoration" >make</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> © Copyright 2022, Tony Mitchell</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Building AVR projects with make - Tony Mitchell&amp;url=https://www.tonymitchell.ca/posts/building-avr-projects-with-make/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Building AVR projects with make - Tony Mitchell&amp;u=https://www.tonymitchell.ca/posts/building-avr-projects-with-make/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://www.tonymitchell.ca/posts/building-avr-projects-with-make/&amp;text=Building AVR projects with make - Tony Mitchell" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/programming-avr-in-wsl-tips-and-tricks/">Programming AVR in WSL Tips and Tricks</a><li><a href="/posts/manually-install-avr-tools-on-linux/">How to manually install AVR tools on Linux (or WSL2)</a><li><a href="/posts/setup-avr-toolchain-on-linux/">How to setup the AVR toolchain on Linux</a><li><a href="/posts/setup-avr-toolchain-on-windows/">How to setup the AVR toolchain on Windows</a><li><a href="/posts/setup-avr-toolchain-on-wsl/">How to setup the AVR toolchain on WSL2 (Windows 10+)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/avr/">avr</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/avr-gcc/">avr-gcc</a> <a class="post-tag" href="/tags/avrdude/">avrdude</a> <a class="post-tag" href="/tags/wsl/">wsl</a> <a class="post-tag" href="/tags/apt/">apt</a> <a class="post-tag" href="/tags/clockskew/">clockskew</a> <a class="post-tag" href="/tags/make/">make</a> <a class="post-tag" href="/tags/permissions/">permissions</a> <a class="post-tag" href="/tags/tips/">tips</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/programming-avr-in-wsl-tips-and-tricks/"><div class="card-body"> <em class="timeago small" data-ts="1653069600" > 2022-05-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Programming AVR in WSL Tips and Tricks</h3><div class="text-muted small"><p> #1. Fixing device permissions Since systemd is not running under WSL2 some of the UDEV rules won’t run that set the groups, etc. As a result the devices under /dev/ will all be owned by root stil...</p></div></div></a></div><div class="card"> <a href="/posts/manually-install-avr-tools-on-linux/"><div class="card-body"> <em class="timeago small" data-ts="1653152400" > 2022-05-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to manually install AVR tools on Linux (or WSL2)</h3><div class="text-muted small"><p> If you’re just looking to install the AVR tools on Linux or WSL please try one of these approaches first: How to setup the AVR toolchain on Linux How to setup the AVR toolchain on WSL2 (Window...</p></div></div></a></div><div class="card"> <a href="/posts/setup-avr-toolchain-on-linux/"><div class="card-body"> <em class="timeago small" data-ts="1653152400" > 2022-05-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to setup the AVR toolchain on Linux</h3><div class="text-muted small"><p> Overview This guide will help you get your environment set up to build projects on the Atmel AVR chips (e.g. ATmega328, ATtiny85, etc.) projects on Windows using Linux-based (Ubuntu) tools. Summa...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/setup-avr-toolchain-on-wsl/" class="btn btn-outline-primary" prompt="Older"><p>How to setup the AVR toolchain on WSL2 (Windows 10+)</p></a> <a href="/posts/use-vscode-with-avr-toolchain/" class="btn btn-outline-primary" prompt="Newer"><p>Use VS Code with the AVR toolchain</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "tonymitchell/tonymitchell", "data-repo-id": "R_kgDOHXxQjg", "data-category": "Blog Post", "data-category-id": "DIC_kwDOHXxQjs4CPYWS", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/tony_a_mitchell">Tony Mitchell</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are copyrighted.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/avr/">avr</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/avr-gcc/">avr-gcc</a> <a class="post-tag" href="/tags/avrdude/">avrdude</a> <a class="post-tag" href="/tags/wsl/">wsl</a> <a class="post-tag" href="/tags/apt/">apt</a> <a class="post-tag" href="/tags/clockskew/">clockskew</a> <a class="post-tag" href="/tags/make/">make</a> <a class="post-tag" href="/tags/permissions/">permissions</a> <a class="post-tag" href="/tags/tips/">tips</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-24CRE7MHRV"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-24CRE7MHRV'); }); </script>
