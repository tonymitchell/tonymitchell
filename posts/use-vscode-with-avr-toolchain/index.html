<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Use VS Code with the AVR toolchain" /><meta property="og:locale" content="en" /><meta name="description" content="Overview" /><meta property="og:description" content="Overview" /><link rel="canonical" href="https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/" /><meta property="og:url" content="https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/" /><meta property="og:site_name" content="Tony Mitchell" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-21T11:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Use VS Code with the AVR toolchain" /><meta name="twitter:site" content="@tony_a_mitchell" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-06T18:55:33-07:00","datePublished":"2022-05-21T11:00:00-07:00","description":"Overview","headline":"Use VS Code with the AVR toolchain","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/"},"url":"https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/"}</script><title>Use VS Code with the AVR toolchain | Tony Mitchell</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Tony Mitchell"><meta name="application-name" content="Tony Mitchell"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/1694080?s=400&v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Tony Mitchell</a></div><div class="site-subtitle font-italic">My little piece of the net</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/tonymitchell" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/tony_a_mitchell" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Use VS Code with the AVR toolchain</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Use VS Code with the AVR toolchain</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/tony_a_mitchell">Tony Mitchell</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1653156000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-21 </em> </span> <span> Updated <em class="timeago" data-ts="1654566933" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-06 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1104 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This guide will take you through the steps to configure Visual Studio Code for AVR programming in C/C++, including working Intellisense and a build task to execute your Makefile with different targets.</p><h2 id="prerequisites"><span class="mr-2">Prerequisites</span><a href="#prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="setup-avr-toolchain"><span class="mr-2">Setup AVR toolchain</span><a href="#setup-avr-toolchain" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>If you haven’t already done so, start by setting up the AVR tool chain on your system so you can build AVR projects.</p><p>Follow the appropriate guide for your platform:</p><ul><li><a href="/posts/setup-avr-toolchain-on-windows/">Windows-based AVR toolchain</a><li><a href="/posts/setup-avr-toolchain-on-wsl/">WSL-based AVR toolchain</a><li><a href="/posts/setup-avr-toolchain-on-linux/">Linux-based toolchain</a></ul><p>While you’re at it you might as well head over and set up a Makefile to build your project now too as we’ll need that later when we set up the build task:</p><ul><li><a href="/posts/building-avr-projects-with-make/">Building AVR projects with make</a></ul><h3 id="install-visual-studio-code"><span class="mr-2">Install Visual Studio Code</span><a href="#install-visual-studio-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Download and install <a href="https://code.visualstudio.com/download">Visual Studio Code</a></p><h3 id="install-cc-extension-pack"><span class="mr-2">Install C/C++ extension pack</span><a href="#install-cc-extension-pack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Install the <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools-extension-pack">C/C++ extension pack</a></p><h3 id="review-visual-studio-code-cc-documentation"><span class="mr-2">Review Visual Studio Code C/C++ documentation</span><a href="#review-visual-studio-code-cc-documentation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>If you’re not familiar with using VS Code with C/C++ on your chosen platform (Windows, WSL, Linux) I encourage you read through the VS Code documentation first before continuing.</p><p>Basic configuration</p><ul><li><a href="https://code.visualstudio.com/docs/cpp/config-linux">Using C++ on Linux in VS Code</a><li><a href="https://code.visualstudio.com/docs/cpp/config-wsl">Using C++ and WSL in VS Code</a><li><a href="https://code.visualstudio.com/docs/cpp/config-mingw">Using GCC with MinGW</a> (I use gnuwin32 instead of MingGW)</ul><p>Cross-compiling (which is what we’re doing with AVR)</p><ul><li><a href="https://code.visualstudio.com/docs/cpp/configure-intellisense-crosscompilation">IntelliSense for cross-compiling</a></ul><h2 id="open-the-sample-project"><span class="mr-2">Open the sample project</span><a href="#open-the-sample-project" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Start by opening the folder for your AVR project in VS Code. I’m going to use the blinker sample created in previous tutorials which consists of a folder named blinker, a single .c file named blink.c, and a Makefile. If you don’t already have a known working project to use, I suggest</p><h2 id="edit-cc-configuration"><span class="mr-2">Edit C/C++ configuration</span><a href="#edit-cc-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Open the Command Palette (<code class="language-plaintext highlighter-rouge">Ctrl+Shift+P</code>)</p><p>Search for and run <code class="language-plaintext highlighter-rouge">C/C++: Edit Configurations (JSON)</code>. This will create a new <code class="language-plaintext highlighter-rouge">c_cpp_properties.json</code> file in the <code class="language-plaintext highlighter-rouge">.vscode/</code> directory of your project and open it for editing.</p><p>You will need to make the following changes (see platform specific settings below):</p><ul><li><p><strong>compilerPath</strong>: Update to avr-gcc (see platform specific settings below)</p><div class="table-wrapper"><table><tbody><tr><td><code class="language-plaintext highlighter-rouge">"-mmcu=atmega328p"</code><td>Will ensure MCU defines are set correctly<tr><td><code class="language-plaintext highlighter-rouge">"-DF_CPU=16000000UL"</code><td>Will ensure F_CPU is set correctly<tr><td><code class="language-plaintext highlighter-rouge">"-Os"</code><td>Will avoid optimization warnings re: _delay</table></div><li><strong>intelliSenseMode</strong>: Update to {os}-gcc-{arch} (“windows-gcc-x64” or “linux-gcc-x64” most likely)<li><strong>compilerArgs</strong>: Add any compiler arguments you use such as the mcu, F_CPU define, and optimization (-Os). These are necessary for the compiler and VS Code to work together to produce the right set of macros #defines for your MCU.</ul><blockquote class="prompt-tip"><div><p><strong>includePath</strong>: No need to specify the AVR include paths as they will be included automatically.</p><p>From the <a href="https://code.visualstudio.com/docs/cpp/configure-intellisense-crosscompilation#_include-path">VS Code documentation</a>: <em>“You only need to modify the Include path if your program includes header files that aren’t in your workspace, or that are not in the standard library path. The C/C++ extension populates the include path by querying the compiler specified by Compiler path. If the extension can’t find the path for the target system libraries, you can enter the include path manually”</em></p></div></blockquote><p>On WSL / Linux:</p><ul><li>Change “intelliSenseMode” to “linux-gcc-x64”<li>Update the compilerPath to “/usr/bin/avr-gcc”<li>Include path: <strong>(Only if necessary)</strong><ul><li>e.g. /usr/lib/avr/include/<li>You can find the path by running the command:<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  dpkg -L avr-libc | grep avr/io.h
</pre></table></code></div></div></ul></ul><p>On Windows:</p><ul><li>Change “intelliSenseMode” to “windows-gcc-x64”<li>Update the compilerPath to avr-gcc.exe<ul><li>e.g. C:\AVR\avr8-gnu-toolchain\bin\avr-gcc.exe</ul><li>Include path: <strong>(Only if necessary)</strong><ul><li>This is under the avr8-gnu-toolchain directory we created in the install<li>e.g. C:\AVR\avr8-gnu-toolchain\avr\include\</ul></ul><p>When you’re done it should like one of these examples below (depending on your platform).</p><p>On Linux:</p><div file="c_cpp_properties.json" class="language-jsonc highlighter-rouge"><div class="code-header"> <span data-label-text="c_cpp_properties.json"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Linux"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"includePath"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"${workspaceFolder}/**"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"defines"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"compilerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/usr/bin/avr-gcc"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gnu11"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cppStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gnu++14"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"intelliSenseMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linux-gcc-x64"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"compilerArgs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"-mmcu=atmega328p"</span><span class="p">,</span><span class="w">     </span><span class="c1">// Will ensure MCU defines are set correctly</span><span class="w">
                </span><span class="s2">"-DF_CPU=16000000UL"</span><span class="p">,</span><span class="w">   </span><span class="c1">// Will ensure F_CPU is set correctly</span><span class="w">
                </span><span class="s2">"-Os"</span><span class="w">                   </span><span class="c1">// Will avoid optimization warnings re: _delay</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>On Windows:</p><div file="c_cpp_properties.json" class="language-jsonc highlighter-rouge"><div class="code-header"> <span data-label-text="c_cpp_properties.json"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Win32"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"includePath"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"${workspaceFolder}/**"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"defines"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"_DEBUG"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"UNICODE"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"_UNICODE"</span><span class="w">                
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"compilerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C:/AVR/avr8-gnu-toolchain/bin/avr-gcc.exe"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gnu11"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"cppStandard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gnu++14"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"intelliSenseMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"windows-gcc-x64"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"compilerArgs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"-mmcu=atmega328p"</span><span class="p">,</span><span class="w">     </span><span class="c1">// Will ensure MCU defines are set correctly</span><span class="w">
                </span><span class="s2">"-DF_CPU=16000000UL"</span><span class="p">,</span><span class="w">   </span><span class="c1">// Will ensure F_CPU is set correctly</span><span class="w">
                </span><span class="s2">"-Os"</span><span class="w">                   </span><span class="c1">// Will avoid optimization warnings re: _delay</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Now that the above configration has been completed, your Intellisense should be working and you could use the built-in gcc build tasks via <strong>Run Build Task…</strong> (<code class="language-plaintext highlighter-rouge">Ctrl+Shift+B</code>) to run a simple build, but we’re going to use a <code class="language-plaintext highlighter-rouge">Makefile</code>. If you don’t have a Makefile for your project, you can create one in <a href="/posts/building-avr-projects-with-make/">Building AVR projects with make</a>.</p><p>In the next step we’ll configure VS Code to build the project using your Makefile.</p><h2 id="build-tasks"><span class="mr-2">Build tasks</span><a href="#build-tasks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s start by creating a <code class="language-plaintext highlighter-rouge">tasks.json</code> in our .vscode directory to define our new build task. While you can do this manually, we’re going to have VS Code generate the basic template for us.</p><ol><li>From the Terminal menu, select <strong>Configure Tasks…</strong>. Or search for <strong>Configure Task</strong> from the Command Palette (<code class="language-plaintext highlighter-rouge">Ctrl+Shift+P</code>)<li>Choose <strong>Create tasks.json file from template</strong><li>Choose <strong>Others</strong></ol><p>Setting up a build task using make</p><div file="tasks.json" class="language-jsonc highlighter-rouge"><div class="code-header"> <span data-label-text="tasks.json"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"tasks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"detail"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Run make"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shell"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${input:makeTarget} "</span><span class="p">,</span><span class="w">
            </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"problemMatcher"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"$gcc"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"group"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"build"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"inputs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> 
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pickString"</span><span class="p">,</span><span class="w"> 
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"makeTarget"</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Select a build target"</span><span class="p">,</span><span class="w"> 
            </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"make all"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sudo make flash"</span><span class="p">,</span><span class="w"> </span><span class="s2">"make disassemble"</span><span class="p">,</span><span class="w"> </span><span class="s2">"make squeaky_clean"</span><span class="p">,</span><span class="w"> </span><span class="s2">"make size"</span><span class="p">,</span><span class="w"> </span><span class="s2">"make debug"</span><span class="p">,</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"make all"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="variations"><span class="mr-2">Variations</span><a href="#variations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="windows-but-using-wsl-for-make"><span class="mr-2">Windows but using WSL for make</span><a href="#windows-but-using-wsl-for-make" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>make via WSL from Windows</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wsl make all
</pre></table></code></div></div><h3 id="using-windows-based-tools-that-arent"><span class="mr-2">Using Windows-based tools that aren’t</span><a href="#using-windows-based-tools-that-arent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>access to windows maked tools</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="s2">"Setting AVR build paths"</span><span class="w">
</span><span class="nv">$toolpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\AVR"</span><span class="w">
</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">PATH</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">";</span><span class="nv">$toolpath</span><span class="s2">\avr8-gnu-toolchain\bin"</span><span class="w">
</span><span class="nv">$</span><span class="nn">Env</span><span class="p">:</span><span class="nv">PATH</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">";</span><span class="nv">$toolpath</span><span class="s2">\avrdude"</span><span class="w">
</span></pre></table></code></div></div><h2 id="troubleshooting"><span class="mr-2">Troubleshooting</span><a href="#troubleshooting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><dl><dt>VS Code can’t find my AVR headers.<dd><ol><li>First check that your AVR headers are installed. On Ubuntu Linux/WSL this is a separate package: <code class="language-plaintext highlighter-rouge">avr-libc</code>.<li>Next check that you’ve specified the compilerPath and compilerArgs appropriately as VS Code finds the include paths by interrogating the compiler.</ol><dt>VS Code STILL can’t find my AVR headers.<dd>Add the path to the AVR include paths manually.<p>On Linux:</p><ul><li>e.g. /usr/lib/avr/include/<li>You can find the path by running the command:<div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">  dpkg -L avr-libc | grep avr/io.h
</span></pre></table></code></div></div></ul><p>On Windows:</p><ul><li>This is under the avr8-gnu-toolchain directory we created in the install<li>e.g. C:\AVR\avr8-gnu-toolchain\avr\include\</ul><dt>It’s still not working<dd>Check out the <a href="https://code.visualstudio.com/docs/cpp/faq-cpp">VS Code FAQ</a> for more help.</dl></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorial/'>Tutorial</a>, <a href='/categories/avr/'>AVR</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a> <a href="/tags/avr/" class="post-tag no-text-decoration" >avr</a> <a href="/tags/vscode/" class="post-tag no-text-decoration" >vscode</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> © Copyright 2022, Tony Mitchell</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Use VS Code with the AVR toolchain - Tony Mitchell&amp;url=https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Use VS Code with the AVR toolchain - Tony Mitchell&amp;u=https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://www.tonymitchell.ca/posts/use-vscode-with-avr-toolchain/&amp;text=Use VS Code with the AVR toolchain - Tony Mitchell" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/programming-avr-in-wsl-tips-and-tricks/">Programming AVR in WSL Tips and Tricks</a><li><a href="/posts/manually-install-avr-tools-on-linux/">How to manually install AVR tools on Linux (or WSL2)</a><li><a href="/posts/setup-avr-toolchain-on-linux/">How to setup the AVR toolchain on Linux</a><li><a href="/posts/setup-avr-toolchain-on-windows/">How to setup the AVR toolchain on Windows</a><li><a href="/posts/setup-avr-toolchain-on-wsl/">How to setup the AVR toolchain on WSL2 (Windows 10+)</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/avr/">avr</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/avr-gcc/">avr-gcc</a> <a class="post-tag" href="/tags/avrdude/">avrdude</a> <a class="post-tag" href="/tags/wsl/">wsl</a> <a class="post-tag" href="/tags/apt/">apt</a> <a class="post-tag" href="/tags/clockskew/">clockskew</a> <a class="post-tag" href="/tags/make/">make</a> <a class="post-tag" href="/tags/permissions/">permissions</a> <a class="post-tag" href="/tags/tips/">tips</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/programming-avr-in-wsl-tips-and-tricks/"><div class="card-body"> <em class="timeago small" data-ts="1653069600" > 2022-05-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Programming AVR in WSL Tips and Tricks</h3><div class="text-muted small"><p> #1. Fixing device permissions Since systemd is not running under WSL2 some of the UDEV rules won’t run that set the groups, etc. As a result the devices under /dev/ will all be owned by root stil...</p></div></div></a></div><div class="card"> <a href="/posts/manually-install-avr-tools-on-linux/"><div class="card-body"> <em class="timeago small" data-ts="1653152400" > 2022-05-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to manually install AVR tools on Linux (or WSL2)</h3><div class="text-muted small"><p> If you’re just looking to install the AVR tools on Linux or WSL please try one of these approaches first: How to setup the AVR toolchain on Linux How to setup the AVR toolchain on WSL2 (Window...</p></div></div></a></div><div class="card"> <a href="/posts/setup-avr-toolchain-on-linux/"><div class="card-body"> <em class="timeago small" data-ts="1653152400" > 2022-05-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to setup the AVR toolchain on Linux</h3><div class="text-muted small"><p> Overview This guide will help you get your environment set up to build projects on the Atmel AVR chips (e.g. ATmega328, ATtiny85, etc.) projects on Windows using Linux-based (Ubuntu) tools. Summa...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/building-avr-projects-with-make/" class="btn btn-outline-primary" prompt="Older"><p>Building AVR projects with make</p></a> <a href="/posts/wsl-tnt-update-wsl-linux-env/" class="btn btn-outline-primary" prompt="Newer"><p>Apply updates to multiple WSL Linux environments quickly</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "tonymitchell/tonymitchell", "data-repo-id": "R_kgDOHXxQjg", "data-category": "Blog Post", "data-category-id": "DIC_kwDOHXxQjs4CPYWS", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/tony_a_mitchell">Tony Mitchell</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are copyrighted.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/avr/">avr</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/avr-gcc/">avr-gcc</a> <a class="post-tag" href="/tags/avrdude/">avrdude</a> <a class="post-tag" href="/tags/wsl/">wsl</a> <a class="post-tag" href="/tags/apt/">apt</a> <a class="post-tag" href="/tags/clockskew/">clockskew</a> <a class="post-tag" href="/tags/make/">make</a> <a class="post-tag" href="/tags/permissions/">permissions</a> <a class="post-tag" href="/tags/tips/">tips</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-24CRE7MHRV"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-24CRE7MHRV'); }); </script>
